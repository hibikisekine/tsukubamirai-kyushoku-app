# 「食べたい」ボタンのデプロイ手順

## ⚠️ 重要：反映させるために必要な作業

「食べたい」ボタンをサイトに反映させるには、以下の2つの作業が必要です：

### 1. データベーステーブルの作成（必須）

SupabaseのSQL Editorで以下のSQLを実行してください：

1. Supabaseのダッシュボードにログイン
2. 左メニューから「SQL Editor」を選択
3. 新規クエリを作成
4. `supabase-likes-table.sql`の内容をコピー＆ペースト
5. 「Run」ボタンをクリックして実行

**SQLファイルの場所**: `/給食サイト/supabase-likes-table.sql`

### 2. コードのデプロイ

以下のコマンドを実行して、変更をコミット・プッシュ・デプロイしてください：

```bash
cd /Users/hs/Cursor/給食サイト

# 変更をステージング
git add app/api/likes/ components/LikeButton.tsx app/[date]/page.tsx app/page.tsx supabase-likes-table.sql

# コミット
git commit -m "Add: 食べたいボタン機能を追加"

# プッシュ（Vercelを使用している場合）
git push origin main

# Vercelが自動デプロイを開始します
```

## デプロイ後の確認

### 1. サイトで確認
- ホームページ（`/`）の各メニューカードに「食べたい」ボタンが表示される
- メニュー詳細ページ（`/[date]`）にも「食べたい」ボタンが表示される

### 2. APIの動作確認
ブラウザの開発者ツール（F12）のコンソールで以下を実行：

```javascript
// カウントを取得
fetch('/api/likes?date=2025-11-14&type=A')
  .then(res => res.json())
  .then(data => console.log('Count:', data.count));

// カウントを増やす
fetch('/api/likes', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ date: '2025-11-14', type: 'A' })
})
  .then(res => res.json())
  .then(data => console.log('New count:', data.count));
```

### 3. データベースの確認
Supabaseのダッシュボードで：
- `kondate_likes`テーブルが存在することを確認
- ボタンを押した後、データが保存されていることを確認

## トラブルシューティング

### ボタンが表示されない場合
1. ブラウザのキャッシュをクリア（Cmd+Shift+R / Ctrl+Shift+R）
2. デプロイが完了しているか確認
3. ブラウザのコンソールでエラーを確認

### ボタンを押してもカウントが増えない場合
1. データベーステーブルが作成されているか確認
2. Supabaseの環境変数が正しく設定されているか確認
3. ブラウザのコンソールでエラーを確認

### APIエラーが発生する場合
1. Supabaseの接続設定を確認
2. `NEXT_PUBLIC_SUPABASE_URL`と`NEXT_PUBLIC_SUPABASE_ANON_KEY`が設定されているか確認
3. `SUPABASE_SERVICE_ROLE_KEY`が設定されているか確認（POST用）

