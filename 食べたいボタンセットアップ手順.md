# 「食べたい」ボタン機能のセットアップ手順

## 概要
各給食メニューに「食べたい」ボタンを追加し、押された数をカウントできる機能を実装しました。

## セットアップ手順

### 1. データベーステーブルの作成

SupabaseのSQL Editorで以下のSQLを実行してください：

```sql
-- supabase-likes-table.sql の内容を実行
```

または、`supabase-likes-table.sql`ファイルの内容をコピーして実行してください。

### 2. 環境変数の確認

以下の環境変数が設定されていることを確認してください：

- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`

### 3. 実装内容

#### 作成されたファイル

1. **`supabase-likes-table.sql`**
   - データベーステーブル作成用SQL
   - `kondate_likes`テーブルを作成

2. **`app/api/likes/route.ts`**
   - APIエンドポイント
   - GET: カウントを取得
   - POST: カウントを増やす

3. **`components/LikeButton.tsx`**
   - 「食べたい」ボタンのコンポーネント
   - クライアントコンポーネント（useState, useEffect使用）

#### 修正されたファイル

1. **`app/[date]/page.tsx`**
   - メニュー詳細ページに「食べたい」ボタンを追加

2. **`app/page.tsx`**
   - ホームページのカードに「食べたい」ボタンを追加

## 機能の使い方

### ユーザー側

1. ホームページまたはメニュー詳細ページで「食べたい」ボタンをクリック
2. ボタンが押されると、カウントが1増えます
3. ボタンは1回だけ押すことができます（重複防止）
4. 押された後は「✓ 食べたい！」と表示され、緑色になります

### 管理者側

カウント数は以下の方法で確認できます：

1. **Supabaseのダッシュボード**
   - `kondate_likes`テーブルを確認
   - `date`, `type`, `count`カラムで各メニューのカウント数を確認

2. **API経由**
   ```bash
   curl "https://your-domain.com/api/likes?date=2025-11-14&type=A"
   ```

## データベース構造

### kondate_likes テーブル

| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | BIGSERIAL | 主キー |
| date | DATE | 献立の日付 |
| type | TEXT | 献立タイプ（'A' または 'B'） |
| count | INTEGER | 「食べたい」のカウント数 |
| created_at | TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | 更新日時 |

## 注意事項

1. **重複防止**
   - 現在の実装では、同じブラウザセッションで1回だけ押せるようになっています
   - より厳密な重複防止が必要な場合は、IPアドレスやCookieを使用した実装に変更できます

2. **パフォーマンス**
   - カウント数はページ読み込み時に取得されます
   - リアルタイムで更新する必要がある場合は、WebSocketやServer-Sent Eventsの実装を検討してください

3. **セキュリティ**
   - 現在はAPIキーで制御していますが、必要に応じてレート制限を追加してください

## 今後の拡張案

1. **ユーザー認証**
   - ログイン機能を追加して、ユーザーごとに1回だけ押せるようにする

2. **統計表示**
   - 人気のメニューランキングを表示
   - 週間・月間の人気メニューを表示

3. **通知機能**
   - 人気のメニューが来週あることを通知

4. **コメント機能**
   - メニューに対するコメントを追加


